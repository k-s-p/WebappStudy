# Webアプリケーションに関する勉強記録

最近Webアプリケーション作成に興味を持ちましたが、知識が足りないと痛感しました…

そのため、この
[伸び悩んでいる3年目Webエンジニアのための、Python Webアプリケーション自作入門](https://zenn.dev/bigen1925/books/introduction-to-web-application-with-python)
を読み、Webアプリケーションとはどういうものなのかを理解していけたらと思います。
私は3年目でもなければWebエンジニアでもないのですが、とてもわかりやすく楽しい内容だと思うので、興味のある方はこの本を読んでみてください。

本記事は、Chapter1～Chapter8の内容について、自分用のまとめとして作成しています。

## [Webアプリケーションとはなにか](https://zenn.dev/bigen1925/books/introduction-to-web-application-with-python/viewer/what-is-web-application)

### Webアプリケーションについて

`Webアプリケーションとは、Webサービスを提供するプログラムである`

乱暴にかみ砕くとこのように言えます。Webサービスというのはブラウザを介して利用するサービスのことで、GmailやGithubなど普段私たちがブラウザ上で利用しているもののことです。このWebサービスは、プログラミンした文字列ではなく、それらを解釈して実行した結果実現される機能群です。なので、このWebアプリケーションのソースコードを書き、あるプログラムで実行することで、Webサービスが私たちに提供されています。

以下の画像がWebアプリケーションの概要図になります。ブラウザがWebサーバーへ何かリクエストを送信すると、Webサーバーは、Webフレームワークを介してサービスごとに固有のプログラムをブラウザに返してくれます。この*Webサーバー＋Webフレームワーク+サービスごとに固有のライブラリ*をまとめてWebアプリケーションと呼ぶことができます。

![Webアプリケーション概要図](https://storage.googleapis.com/zenn-user-upload/ksrjkz0as27wslgnfsqd2oi20rn5)

### Webサーバとはなにか

Webサーバーとは、Webサービスを提供する**プログラム**と考えていいです。ここで、Webアプリケーションもそうだったじゃないかと思いますよね。実は広義の意味ではこの二つは同じ意味なのですが、多くの場合、WebサーバーはWebアプリケーションの中でも特にWebサービスを提供する窓口部分のプログラムのことだけを指します。

Webサービスはかつては単一のプログラムで提供されており、それをWebサーバーと呼んでいました。しかし、提供するサービスがとても多くなり、よりリッチなサービスとなったため、どんなWebサービスでも使用する共通部分は共通プログラムとして、サービスごとのプログラムと分けて作成するようになりました。その結果、この共通プログラム部分がWebサーバーと呼ばれるものになってきました。

Webサーバーの代表例として、apacheやnginxがあります。

### Webフレームワークについて

先ほどのサービスごとのプログラムの中にも、定番の共通機能がよく見られ、それらがライブラリとして世の中に出回っていきました。それが*Webフレームワーク*と呼ばれるものです。
Webサーバー上で追加で動かすような構成になっており、PythonのDjangoや、Laravelなどがあります。

### Webサーバ以外のサーバ

Webサーバは別名HTTPサーバと呼ばれ、クライアントとHTTPというプロトコルで通信します。他にも様々なサーバが存在し、それぞれプロトコルの違いにより区別されています。

* DBサーバ：RDBMSなど、データを格納し走査するためのサーバ
* ファイルサーバ：主に企業等で用いられる、メンバーがLANの中で自由にファイルを保存し、共有できる仕組みに使用されるサーバコンピュータ
* メールサーバ：メールの送信・受信の役割を持つサーバ

### 通信プロトコルについて

通信プロトコルとは、通信する際の規格のことです。この取り決めを守ることで、メーカー、機種などに左右されずに、全てのパソコンやサーバ間で通信を行うことができます。データの通信ではパケット交換方式が用いられています。これは、通信データをパケットと言われる単位に分割し送ることで、多くのユーザが同時にデータを送受信することを可能にしています。パケットは、ヘッダという通信先や通信元の情報と分割されたデータによって構成されています。

* HTTP：ブラウザとWebサーバが通信する際に使われるプロトコル
* SMTP/POP/IMAP：メールの送受信委関するプロトコル。SMTPはメールの送信、POPはメールサーバから電子メールを受信する際に、IMAPはメールをサーバ上で保持し続ける際に使用するプロトコル。
* FTP：クライアントとサーバ間のファイル転送の際に使用されるプロトコル

## [簡易Webサーバーを作る手順](https://zenn.dev/bigen1925/books/introduction-to-web-application-with-python/viewer/making-silly-web-server)

実際にWebサーバとブラウザが通信しているところを確認し、真似することで簡易的なWebサーバを作ります。

### [STEP1:ChromeとApacheで通信してみる](https://zenn.dev/bigen1925/books/introduction-to-web-application-with-python/viewer/making-silly-web-server-step1)

以下画像の状態を作る。
![chrome=Apache](https://storage.googleapis.com/zenn-user-upload/7ifzdeu5ep46jgatktt3zty2owhm)

#### ブラウザとWebサーバーが「通信する」とは

ChromeとApacheの通信、つまり、ブラウザとWebサーバの通信というのは、ブラウザからWebサーバに向かってリクエスト(Webサービスを提供してほしい)を送り、Webサーバがそれに対してレスポンス(Webサービス)を返すということです。

#### ブラウザからWebサーバーへリクエストを送るためには

インターネット上で、あるプログラムが別のプログラムへ何かを送るとき、必要となるのは**宛先**と**内容**です。
このうち、Chromeでは、**宛先**だけをURLバーに入力すれば、**内容**は自動で生成されます。

ここで、Webサービスにおける**宛先**のことを、**URL**と呼び、以下のような形式で表現されます。

<span style="font-size: 150%;"> URL = \*\* `<protocol>` : // `<host>` : `<port>` / `<path>` ?\*\* `<query>` </span>

#### protocol

リクエストの送り方を指定する。Webサービスでは`http`や`https`がよく用いられる。郵便に例えると、「普通郵便」や「本人限定受取」といった郵便の送り方のようなものです。このように、宛先や内容には関係ないですが、送る手順や受け取り方がprotocolごとに変わります。

`http`ではいわば普通郵便で、送りたい内容をそのまま送ります。
`https`は暗号化通信で、`http`よりセキュアな通信が可能となります。

#### host

送り先のWebサーバープログラムが動いているマシン(=コンピュータ)のインターネット上の住所を示します。基本的には、インターネット上のマシンを特定するために`IPアドレス`を使用する。

IPアドレス以外に`host`に使用できるものとして以下のものがあります。

* DNSに登録されたドメイン:`zenn.dev`　`google.com`など

* localhost：IPアドレス`127.0.0.1`とみなされ、自分のＰＣを指す。

ただ、自分のPC上には様々なプログラムが動いており、`host`だけでは宛先として不十分となります。例えば、マンションで、住所だけがわかっても部屋の番号がわからないような状態といえます。そこで、必要になるのが`port`です。

#### port

`port`は、インターネット通信の際に特定のマシンの中で動いている複数のプログラムから、目的のプログラムを特定するための番号。通常、ＰＣやサーバー上では複数のプログラムが動いているため、ポート番号を指定することで、同一IPのプログラムの中から、任意のプログラムへリクエストを送ることができる。

port番号は、プログラム起動時にプログラムが0～65535番の中から自分で設定することができる。

* Well-Known ports : 複数のプログラムが同じportを番号を使うことはできず、後からそのport番号を割り振ろうとしたほうがエラーとなってしまいます。そのため、どのマシンでもよく使うようなプログラムには予めport番号が予約されており、このport番号のことを`well-known ports`という。0～1023番まではすでに決まっている。例えば、`HTTP`は80番、`HTTPS`は443番、`FTP`は20・21番など。ただし、必ずしもwell-known portsでサービスを動作させる必要はなく、ソフトウェアによって設定できるようになっていることが多いです。

多くのブラウザでは、http通信する際は、デフォルトで80番ポートへ向けて通信すると決まっているため、httpでポートが80番の場合に限り、port番号を省略し、`http://localhost/~`と書いてもいいです。

#### path

上記の、`protocol`,`host`,`port`がそろえば、ブラウザは相手のWebサーバプログラムの場所を特定して、通信を始めることができます。しかし、一般的に1つのWebサービスに対する要求は1種類ではありません。そのため、どのようなサービスを要求したいかを伝える目的で、pathにその情報を追加します。

pathは、`/`区切りで、サーバ内部のアクセスする対象のファイルの場所を指定する。初期のウェブでは、ウェブサーバー上の物理的なファイルの場所を指定していたが、現在は物理的なものではなく、ウェブサーバーによって処理される、抽象的なものを指定することが多いです。

#### query

`query`は、pathに加えて、何か情報を追加で送りたいときに使います。送る情報は、名前と値を`=`で区切り、パラメータ同士を`&`で区切ります。ウェブサーバーに与える引数のようなものです。

### [STEP2:ブラウザと自作サーバーで通信してみる](https://zenn.dev/bigen1925/books/introduction-to-web-application-with-python/viewer/making-silly-web-server-step2)

#### TCPサーバー

TCPサーバーとは、TCP(Transmission Control Protocol)で通信を行うサーバーのことです。TCPは、IPの上位プロトコルで、トランスポート層で動作します。ネットワーク層のIPとセッション層以上のプロトコル(HTTP,FTP,telnet)の橋渡しをする形で動作しています。トランスポート層では、UDPというプロトコルも存在しています。

* UDP : コネクションレス型通信(通信開始前に相手との間で事前のやり取りをしない)。通信の信頼性(データの漏れや、順序が守られているかどうか)は高くないが、高速でリアルタイムの通信を行えます。
* TCP : コネクション型通信(3 wayハンドシェイク)。通信の信頼性が高いです

TCPのコネクションは、`3wayハンドシェイク`と呼ばれるほうほうで結ぶ、通信相手との仮想の通信路のことをいいます。

### [STEP3:自作クライアントとApacheで通信してみる](https://zenn.dev/bigen1925/books/introduction-to-web-application-with-python/viewer/making-silly-web-server-step2)

### [STEP4:自作サーバーを進化させる](https://zenn.dev/bigen1925/books/introduction-to-web-application-with-python/viewer/making-silly-web-server-step2)
